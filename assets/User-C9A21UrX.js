import{aS as b,a as C,r as R,k as S,o as h,c as T,b as U,d as t,w as s,e,f,t as c,F as q,p as ee,n as le,ah as oe,aT as te,E as ae,i as re,aj as ne,z as se,y as de}from"./index-eULJHsq-.js";import{u as ie,E as me}from"./use-table-handlers-D-vPMUBE.js";import{E as ue}from"./el-switch-CT8wiS4U.js";import{E as pe}from"./el-radio-ayDhzHag.js";import{a as fe,E as ce}from"./el-form-item-1NvOx5oQ.js";import{a as be}from"./app-role-D9T9iBmR.js";import{l as _e}from"./app-dept-DcIJjicz.js";const ge=d=>b({url:"app/user/listPage",method:"post",data:d}),he=d=>b({url:"app/user/save",method:"post",data:d}),Ve=d=>{const{id:o}=d;return delete d.id,b({url:`app/user/update/${o}`,method:"post",data:d})},Ee=d=>b({url:"app/user/delete",method:"post",data:d}),ve={class:"main-body"},Ie={class:"toolbar"},Ue={__name:"User",setup(d){const o=C({id:"",name:"",deptId:"",email:"",mobile:"",roleIds:[],status:!0}),u=C({name:""}),{t:l,tableRef:x,dialogVisible:_,isEdit:g,formLoading:B,formRef:V,doSearch:D,doAdd:O,doEdit:W,doSubmit:$,doRemove:F,doClose:E}=ie(o),v=R([]),I=R([]),N=S(()=>[{type:"selection"},{prop:"id",label:l("thead.ID"),minWidth:50},{prop:"name",label:l("thead.username"),minWidth:120},{prop:"deptName",label:l("thead.dept"),minWidth:120,showOverflowTooltip:!0},{prop:"roleNames",label:l("thead.role"),minWidth:100,showOverflowTooltip:!0},{prop:"email",label:l("thead.email"),minWidth:120,showOverflowTooltip:!0},{prop:"mobile",label:l("thead.mobile"),minWidth:100},{prop:"status",label:l("thead.status"),minWidth:70,formatter:a=>a.status?l("status.on"):l("status.off")}]),y=(a,r,m)=>{!o.email&&!o.mobile&&m(new Error(l("form.emailOrMobile"))),(!o.mobile||!o.email)&&V.value.clearValidate(a.field==="email"?"mobile":"email"),m()},H=S(()=>({name:[{required:!0,message:l("form.usernameHolder"),trigger:["change","blur"]}],deptId:[{required:!0,message:l("form.deptRequired"),trigger:["change","blur"]}],email:[{type:"email",message:l("form.emailError"),trigger:["change","blur"]},{validator:y,message:l("form.emailOrMobile"),trigger:["change","blur"]}],mobile:[{pattern:/^1[3-9]\d{9}$/,message:l("form.mobileError"),trigger:["change","blur"]},{validator:y,message:l("form.emailOrMobile"),trigger:["change","blur"]}],roleIds:[{required:!0,message:l("form.roleIdsRequired"),trigger:["change","blur"]}]}));function w(){j(),A()}function M(a){w(),O(a)}function P(a){w(),W(a),o.roleIds=a.roleIds.split(",").map(r=>+r),o.status=!!a.status}function j(){_e().then(a=>{v.value=a.data})}function A(){be().then(a=>{I.value=a.data})}function L(a,r){F(Ee,a,r)}function z(){$({save:he,update:Ve,getParams:G},a=>{g.value||te.alert(`${l("tips.success")}${l("form.username")}: ${a.data.name},${l("form.password")}: ${a.data.password}`,l("tips.title"),{confirmButtonText:l("action.confirm")})})}function G(){const a={...o};return g.value||delete a.id,a.roleIds=o.roleIds.join(","),a}return(a,r)=>{const m=ae,i=fe,p=re,k=ce,J=ne,K=pe,Q=se,X=de,Y=ue,Z=me;return h(),T(q,null,[U("div",ve,[U("div",Ie,[t(k,{inline:!0,model:e(u)},{default:s(()=>[t(i,null,{default:s(()=>[t(m,{modelValue:e(u).name,"onUpdate:modelValue":r[0]||(r[0]=n=>e(u).name=n),placeholder:e(l)("thead.username")},null,8,["modelValue","placeholder"])]),_:1}),t(i,null,{default:s(()=>[t(p,{icon:"search",type:"primary",onClick:e(D)},{default:s(()=>[f(c(e(l)("action.search")),1)]),_:1},8,["onClick"])]),_:1}),t(i,null,{default:s(()=>[t(p,{icon:"plus",type:"primary",onClick:M},{default:s(()=>[f(c(e(l)("action.add")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),t(J,{ref_key:"tableRef",ref:x,"get-page":e(ge),filters:e(u),columns:e(N),onHandleEdit:P,onHandleDelete:L},null,8,["get-page","filters","columns"])]),t(Z,{title:e(g)?e(l)("action.edit"):e(l)("action.add"),modelValue:e(_),"onUpdate:modelValue":r[7]||(r[7]=n=>oe(_)?_.value=n:null),draggable:"",width:"50%","close-on-click-modal":!1,onClose:e(E)},{footer:s(()=>[t(p,{onClick:e(E)},{default:s(()=>[f(c(e(l)("action.cancel")),1)]),_:1},8,["onClick"]),t(p,{type:"primary",onClick:z,loading:e(B)},{default:s(()=>[f(c(e(l)("action.submit")),1)]),_:1},8,["loading"])]),default:s(()=>[t(k,{ref_key:"formRef",ref:V,model:e(o),"label-width":"80px",rules:e(H),"label-position":"right"},{default:s(()=>[t(i,{label:e(l)("form.username"),prop:"name"},{default:s(()=>[t(m,{modelValue:e(o).name,"onUpdate:modelValue":r[1]||(r[1]=n=>e(o).name=n)},null,8,["modelValue"])]),_:1},8,["label"]),t(i,{label:e(l)("form.dept"),prop:"deptId"},{default:s(()=>[t(K,{modelValue:e(o).deptId,"onUpdate:modelValue":r[2]||(r[2]=n=>e(o).deptId=n),props:{label:"name",value:"id",checkStrictly:!0,emitPath:!1},options:e(v),clearable:"",filterable:"",class:"w100p"},null,8,["modelValue","options"])]),_:1},8,["label"]),t(i,{label:e(l)("form.email"),prop:"email"},{default:s(()=>[t(m,{modelValue:e(o).email,"onUpdate:modelValue":r[3]||(r[3]=n=>e(o).email=n)},null,8,["modelValue"])]),_:1},8,["label"]),t(i,{label:e(l)("form.mobile"),prop:"mobile"},{default:s(()=>[t(m,{modelValue:e(o).mobile,"onUpdate:modelValue":r[4]||(r[4]=n=>e(o).mobile=n)},null,8,["modelValue"])]),_:1},8,["label"]),t(i,{label:e(l)("form.role"),prop:"roleIds"},{default:s(()=>[t(X,{modelValue:e(o).roleIds,"onUpdate:modelValue":r[5]||(r[5]=n=>e(o).roleIds=n),multiple:"",placeholder:e(l)("form.choose"),style:{width:"100%"}},{default:s(()=>[(h(!0),T(q,null,ee(e(I),n=>(h(),le(Q,{key:n.id,label:n.name,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),t(i,{label:e(l)("status.on")},{default:s(()=>[t(Y,{modelValue:e(o).status,"onUpdate:modelValue":r[6]||(r[6]=n=>e(o).status=n)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue","onClose"])],64)}}};export{Ue as default};
